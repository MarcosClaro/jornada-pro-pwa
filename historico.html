<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jornada Pro - HistÃ³rico</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 16px;
            line-height: 1.6;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ff6600;
            padding-bottom: 10px;
        }
        h1 { font-size: 24px; }
        .back { background: #333; padding: 8px 16px; border: none; color: #fff; cursor: pointer; border-radius: 4px; }
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        select {
            flex: 1;
            padding: 10px;
            border: 2px solid #444;
            background: #222;
            color: #fff;
            border-radius: 4px;
        }
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .history-item {
            background: #222;
            border-left: 4px solid #ff6600;
            padding: 15px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item.corrida { border-left-color: #22c55e; }
        .history-item.abastecimento { border-left-color: #3b82f6; }
        .item-info h3 { margin-bottom: 5px; font-size: 16px; }
        .item-time { font-size: 14px; color: #999; }
        .item-value {
            text-align: right;
            font-weight: bold;
        }
        .item-value.positive { color: #22c55e; }
        .item-value.negative { color: #ef4444; }
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        .empty-state p { font-size: 18px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“„ HistÃ³rico</h1>
        <button class="back" onclick="history.back()">Voltar</button>
    </div>

    <div class="filter-group">
        <select id="filterType" onchange="filterHistory()">
            <option value="">Todos</option>
            <option value="corrida">Corridas</option>
            <option value="abastecimento">Abastecimentos</option>
        </select>
    </div>

    <div class="history-list" id="historyList">
        <div class="empty-state">
            <p>Nenhum registro encontrado</p>
        </div>
    </div>

    <script>
        function loadHistory() {
            const historyContainer = document.getElementById('historyList');
            const items = [];
            
            // Collect all stored data
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('fuelData_') || key.startsWith('journeyData_')) {
                    const data = JSON.parse(localStorage.getItem(key));
                    items.push({
                        type: key.startsWith('fuelData_') ? 'abastecimento' : 'corrida',
                        data: data,
                        timestamp: key.split('_')[1]
                    });
                }
            }
            
            // Sort by newest first
            items.sort((a, b) => b.timestamp - a.timestamp);
            
            if (items.length === 0) {
                historyContainer.innerHTML = '<div class="empty-state"><p>Nenhum registro encontrado</p></div>';
                return;
            }
            
            historyContainer.innerHTML = items.map(item => {
                const date = new Date(item.data.date || parseInt(item.timestamp));
                const formatted = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR');
                
                if (item.type === 'abastecimento') {
                    return `<div class="history-item abastecimento">
                        <div class="item-info">
                            <h3>â›½ ${item.data.fuelType || 'Abastecimento'}</h3>
                            <div class="item-time">${formatted}</div>
                            <div class="item-time">KM: ${item.data.km} | ${item.data.liters}L</div>
                        </div>
                        <div class="item-value negative">-R$ ${parseFloat(item.data.value).toFixed(2)}</div>
                    </div>`;
                } else {
                    return `<div class="history-item corrida">
                        <div class="item-info">
                            <h3>ðŸš— ${item.data.startPoint || 'Corrida'}</h3>
                            <div class="item-time">${formatted}</div>
                            <div class="item-time">${item.data.distance || 0}km | ${item.data.duration || 0}min</div>
                        </div>
                        <div class="item-value positive">+R$ ${parseFloat(item.data.earnings || 0).toFixed(2)}</div>
                    </div>`;
                }
            }).join('');
        }
        
        function filterHistory() {
            const filterType = document.getElementById('filterType').value;
            const items = document.querySelectorAll('.history-item');
            
            items.forEach(item => {
                if (filterType === '' || item.classList.contains(filterType)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Load history when page opens
        document.addEventListener('DOMContentLoaded', loadHistory);
    </script>
</body>
</html>
